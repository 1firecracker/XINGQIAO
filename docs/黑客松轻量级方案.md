# 🚀 星桥系统 - 黑客松轻量级方案

## ⚡ 方案概述

针对黑客松比赛的**24-48小时快速开发**需求，本方案采用**单一FastAPI后端 + React前端**的轻量级架构，聚焦核心功能展示，技术栈精简，部署便捷。

### 🎯 核心目标

- **时间效率**: 24小时内完成可演示的原型
- **功能完整**: 覆盖核心AI训练场景
- **技术简洁**: 最小依赖，最快上手
- **部署便捷**: Docker一键运行

## 🏗️ 轻量级架构设计

```
┌─────────────────────────────────────────────────────┐
│               React 前端 (简化版)                     │
│   - 移除复杂状态管理，简化API调用                    │
├─────────────────────────────────────────────────────┤
│               FastAPI 后端 (单一服务)                 │
│   ┌─────────────────────────────────────────────┐   │
│   │ 核心模块:                                    │   │
│   │  • 训练管理 (Training)                       │   │
│   │  • AI服务 (AI Service)                       │   │
│   │  • 数据存储 (SQLite)                         │   │
│   └─────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────┤
│               SQLite 数据库                          │
├─────────────────────────────────────────────────────┤
│               Docker 容器化                          │
└─────────────────────────────────────────────────────┘
```

## 🛠️ 技术栈选择

### 后端：FastAPI (Python)
```python
# 核心依赖
fastapi==0.104.1
uvicorn==0.24.0
sqlalchemy==2.0.23
alembic==1.12.1
python-multipart==0.0.6
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4

# AI服务
google-genai==0.8.3

# 工具库
pydantic==2.5.0
httpx==0.25.2
```

**选择理由**：
- 🚀 开发速度快，自动生成API文档
- 📝 类型提示，减少bug
- 🔄 异步支持，性能优秀
- 🧪 内置测试客户端

### 前端：React (保持现有，简化)
- 移除复杂状态管理 (Zustand/Redux)
- 使用React Hooks + Context (可选)
- 简化API调用，直接使用fetch
- 保持Tailwind CSS样式

### 数据库：SQLite
- 📁 文件数据库，无需服务器
- 🔧 无配置，直接使用
- 🚀 轻量级，适合演示

## 📊 简化数据模型

### 核心数据表

```sql
-- 用户表 (可选，简化认证)
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT UNIQUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 训练场景表
CREATE TABLE scenarios (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    description TEXT,
    icon TEXT,
    is_custom BOOLEAN DEFAULT FALSE,
    creator_id INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 训练步骤表
CREATE TABLE training_steps (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    scenario_id INTEGER,
    step_order INTEGER,
    instruction TEXT,
    image_prompt TEXT,
    image_url TEXT,
    FOREIGN KEY (scenario_id) REFERENCES scenarios(id)
);

-- 训练记录表
CREATE TABLE training_records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    scenario_id INTEGER,
    user_id INTEGER,
    started_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    completed_at DATETIME,
    score INTEGER,
    total_steps INTEGER,
    completed_steps INTEGER
);

-- 生成内容缓存表
CREATE TABLE generated_content (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    content_type TEXT, -- 'image' or 'audio'
    prompt TEXT,
    content_url TEXT,
    content_data BLOB,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

## 🔗 核心API设计

### 训练管理API

```python
# 核心路由设计
@app.get("/api/scenarios")          # 获取场景列表
@app.post("/api/scenarios")         # 创建自定义场景
@app.get("/api/scenarios/{id}")     # 获取场景详情

@app.post("/api/training/start")    # 开始训练
@app.post("/api/training/{id}/step") # 完成步骤
@app.get("/api/training/history")   # 获取历史

@app.post("/api/ai/generate-image") # 生成图像
@app.post("/api/ai/plan-scenario")  # AI规划场景
```

### 简化API响应

```python
# 统一响应格式
class APIResponse(BaseModel):
    success: bool
    data: Optional[Any] = None
    message: Optional[str] = None
    error: Optional[Dict[str, str]] = None

# 示例响应
{
    "success": true,
    "data": {...},
    "message": "操作成功"
}
```

## 📁 项目结构 (黑客松版本)

```
xingqiao-hackathon/
├── backend/
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py          # FastAPI应用入口
│   │   ├── models.py        # SQLAlchemy模型
│   │   ├── schemas.py       # Pydantic模型
│   │   ├── crud.py          # 数据库操作
│   │   ├── ai_service.py    # AI服务封装
│   │   └── database.py      # 数据库配置
│   ├── requirements.txt
│   └── Dockerfile
├── frontend/
│   ├── src/
│   │   ├── api/             # 简化的API客户端
│   │   ├── components/      # React组件 (复用现有)
│   │   ├── hooks/           # 简化的hooks
│   │   └── types/           # 类型定义
│   ├── package.json
│   └── Dockerfile
├── docker-compose.yml       # 一键启动
└── README.md
```

## ⚡ 快速开发计划

### Phase 1: 后端基础 (4小时)

1. **项目初始化** (30min)
   ```bash
   mkdir xingqiao-hackathon && cd xingqiao-hackathon
   mkdir -p backend/app frontend/src
   ```

2. **FastAPI基础搭建** (1小时)
   - 安装依赖
   - 创建基础应用结构
   - 配置SQLite数据库

3. **核心数据模型** (1小时)
   - 定义SQLAlchemy模型
   - 创建数据库迁移
   - 实现基础CRUD操作

4. **AI服务集成** (1.5小时)
   - 封装Gemini图像生成
   - 实现场景规划功能

### Phase 2: 前端适配 (4小时)

1. **API客户端简化** (1小时)
   - 创建简单的fetch封装
   - 定义API endpoints

2. **组件适配** (2小时)
   - 修改现有组件调用后端API
   - 简化状态管理

3. **界面调整** (1小时)
   - 适配新的数据格式
   - 优化加载状态

### Phase 3: 核心功能实现 (8小时)

1. **场景管理** (2小时)
   - 预设场景导入
   - 自定义场景创建

2. **训练流程** (3小时)
   - 训练会话管理
   - 步骤完成逻辑

3. **数据统计** (2小时)
   - 训练历史
   - 简单统计图表

4. **AI功能集成** (1小时)
   - 图像生成
   - 场景规划

### Phase 4: 部署调试 (4小时)

1. **Docker配置** (1小时)
   - 后端Dockerfile
   - 前端Dockerfile
   - docker-compose.yml

2. **环境配置** (1小时)
   - 环境变量设置
   - CORS配置

3. **测试联调** (1.5小时)
   - API测试
   - 前后端联调

4. **演示优化** (30min)
   - UI优化
   - 错误处理

## 🚀 一键部署方案

### Docker Compose配置

```yaml
version: '3.8'
services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    volumes:
      - ./backend/app.db:/app/app.db
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000

  frontend:
    build: ./frontend
    ports:
      - "3000:80"
    depends_on:
      - backend
    environment:
      - REACT_APP_API_URL=http://backend:8000
```

### 快速启动命令

```bash
# 1. 克隆项目 (如果有)
# git clone <repo> && cd xingqiao-hackathon

# 2. 设置环境变量
cp .env.example .env
# 编辑 .env 设置 GEMINI_API_KEY

# 3. 一键启动
docker-compose up --build

# 4. 访问应用
# 前端: http://localhost:3000
# API文档: http://localhost:8000/docs
```

## 🎯 黑客松演示要点

### 核心功能展示

1. **AI场景生成** ⭐⭐⭐
   - 输入主题，AI自动生成训练步骤
   - 实时生成训练图片
   - 语音指导

2. **训练体验** ⭐⭐⭐
   - 直观的步骤引导
   - 进度跟踪
   - 完成反馈

3. **数据可视化** ⭐⭐
   - 训练历史统计
   - 简单图表展示

### 技术亮点展示

1. **AI集成**: 展示Gemini AI的能力
2. **快速开发**: FastAPI的开发效率
3. **现代化UI**: React + Tailwind的视觉效果
4. **容器化**: Docker一键部署

## 🛡️ 风险控制

### 时间风险
- **预设场景优先**: 先实现预设场景，AI生成作为亮点
- **简化认证**: 可选用户系统，专注核心功能
- **复用前端**: 基于现有React组件，减少开发量

### 技术风险
- **AI服务稳定**: 准备离线演示数据
- **网络问题**: 实现缓存机制
- **依赖问题**: 使用固定版本号

### 演示风险
- **数据准备**: 准备演示数据和图片
- **错误处理**: 完善错误提示
- **性能优化**: 实现图片懒加载

## 📋 开发 checklist

### 后端
- [ ] FastAPI应用初始化
- [ ] SQLite数据库配置
- [ ] 数据模型定义
- [ ] AI服务封装
- [ ] 核心API路由
- [ ] CORS配置

### 前端
- [ ] API客户端配置
- [ ] 组件适配
- [ ] 状态管理简化
- [ ] 错误处理

### 部署
- [ ] Dockerfile配置
- [ ] docker-compose.yml
- [ ] 环境变量配置
- [ ] 联调测试

## 🎉 预期成果

### 功能成果
- ✅ 完整的AI训练场景系统
- ✅ 用户友好的训练界面
- ✅ 数据统计和分析
- ✅ 语音和图像AI功能

### 技术成果
- ✅ 现代化Web架构 (React + FastAPI)
- ✅ AI服务集成 (Google Gemini)
- ✅ 容器化部署 (Docker)
- ✅ 类型安全 (TypeScript + Python)

### 演示成果
- ✅ 可运行的完整应用
- ✅ 吸引人的用户界面
- ✅ 稳定的AI功能展示
- ✅ 专业的项目文档

---

**黑客松时间分配建议**: 24小时 = 8小时开发 + 8小时调试 + 8小时优化

**关键成功因素**: 快速实现核心功能，准备备用方案，确保演示流畅性。
